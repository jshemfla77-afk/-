<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>✨ 나의 오늘의 목표 ✨</title>
<style>
  body { font-family: 'Pretendard', sans-serif; background: #f6f9ff; text-align: center; margin: 0; padding: 0; }
  h1 { margin-top: 40px; color: #222; }
  input, textarea { border: 1px solid #ccc; border-radius: 8px; padding: 10px; width: 300px; margin: 8px; font-size: 15px; }
  button { background: #3b57f6; color: white; border: none; border-radius: 6px; padding: 8px 14px; cursor: pointer; transition: 0.2s; margin: 4px; }
  button:hover { background: #2c45d0; }
  .fade { animation: fade 0.8s ease; }
  @keyframes fade { 0%{opacity:0.2;}100%{opacity:1;} }
</style>
</head>
<body>
  <h1>✨ 나의 오늘의 목표 ✨</h1>

  <div>
    <input id="goalInput" type="text" placeholder="새로운 목표를 입력하세요!" />
    <button id="addGoalBtn">추가</button>
  </div>

  <div>
    <h3>🗓 주간 계획</h3>
    <textarea id="weeklyPlan" rows="4" placeholder="이번 주 계획을 적어보세요!"></textarea><br />
    <button id="savePlanBtn">저장</button>
  </div>

  <hr style="margin:25px 0;">
  <div>
    <h3>☁ Google Drive 백업/복원</h3>
    <button id="loginBtn">Google 로그인</button>
    <button id="manualBackupBtn">수동 백업</button>
  </div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '✅여기에_본인_OAuth_Client_ID_입력'; 
    const API_KEY = '✅여기에_본인_API_KEY_입력';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const FILE_NAME = "my_goals.json";

    function log(t){console.log("📘",t);}
    function showSaved(btn){btn.innerText="✅ 저장됨!";setTimeout(()=>btn.innerText="저장",1200);}

    function initClient(){
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
        scope: SCOPES
      }).then(()=>{
        log("Google API 초기화 완료");
        document.getElementById("loginBtn").disabled=false;
      });
    }

    function handleClientLoad(){ gapi.load('client:auth2', initClient); }

    async function signIn(){
      try{
        await gapi.auth2.getAuthInstance().signIn();
        alert("✅ 로그인 성공!");
        await restoreFromDrive();
      }catch(e){alert("로그인 실패:"+e.message);}
    }

    async function autoBackup(){
      const data={
        goal:document.getElementById('goalInput').value,
        plan:document.getElementById('weeklyPlan').value
      };
      const blob=new Blob([JSON.stringify(data)],{type:'application/json'});
      const files=await gapi.client.drive.files.list({q:`name='${FILE_NAME}'`,fields:'files(id)'});
      if(files.result.files.length>0){
        const fileId=files.result.files[0].id;
        await gapi.client.request({
          path:`/upload/drive/v3/files/${fileId}`,
          method:'PATCH',
          params:{uploadType:'media'},
          body:blob
        });
      }else{
        await gapi.client.drive.files.create({
          resource:{name:FILE_NAME,mimeType:'application/json'},
          media:{mimeType:'application/json',body:blob}
        });
      }
      log("Drive에 자동 백업 완료");
    }

    async function restoreFromDrive(){
      const res=await gapi.client.drive.files.list({q:`name='${FILE_NAME}'`,fields:'files(id)'});
      if(res.result.files.length>0){
        const fileId=res.result.files[0].id;
        const file=await gapi.client.drive.files.get({fileId,alt:'media'});
        const data=JSON.parse(file.body);
        document.getElementById('goalInput').value=data.goal||'';
        document.getElementById('weeklyPlan').value=data.plan||'';
        alert("Drive에서 복원 완료!");
      }else log("Drive에 저장된 파일 없음");
    }

    document.getElementById('loginBtn').onclick=signIn;
    document.getElementById('savePlanBtn').onclick=async(e)=>{
      showSaved(e.target);
      await autoBackup();
    };
    document.getElementById('manualBackupBtn').onclick=autoBackup;

    window.onload=handleClientLoad;
  </script>
</body>
</html>

