<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë‚˜ë§Œì˜ ê³„íší‘œ (ALL-IN-ONE)</title>
<style>
:root {
  --bg:#f6f7fb; --card:#fff; --ink:#0f172a; --line:#e9ecf3;
  --primary:#22c55e; --danger:#ef4444;
}
body {margin:0; font-family:sans-serif; background:var(--bg); color:var(--ink);}
body.dark {--bg:#111827; --card:#1f2937; --ink:#f9fafb; --line:#374151;}
.wrap {max-width:1100px; margin:20px auto; padding:10px;}
.card {background:var(--card); border:1px solid var(--line); border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.06); margin-bottom:20px; padding:16px;}
h1,h2 {margin:0 0 8px;}
.input-row {display:flex; gap:10px;}
input,select,textarea {padding:8px; border:1px solid var(--line); border-radius:8px; background:#fff; width:100%;}
button {cursor:pointer; border:0; border-radius:8px; padding:8px 12px; font-weight:600;}
.btn {background:var(--primary); color:#fff;}
.btn-outline {background:#fff; border:1px solid var(--line);}
.btn-danger {background:var(--danger); color:#fff;}
ul {list-style:none; padding:0; margin:10px 0;}
li.task {display:flex; align-items:center; justify-content:space-between; padding:6px; border-bottom:1px solid var(--line);}
li.task.completed .text {text-decoration:line-through; color:#888;}
li.task .meta {font-size:12px; color:#666;}
.star {cursor:pointer; margin-left:6px; color:#bbb;}
.star.active {color:gold;}
.tag {background:#eef; border-radius:6px; padding:2px 6px; margin-left:4px; font-size:11px;}
/* ì™„ë£Œìœ¨ ê·¸ë˜í”„ */
.ring {--p:0; width:90px; height:90px; border-radius:50%;
 background:conic-gradient(var(--primary) calc(var(--p)*1%),#ddd 0);}
.ring::after {content:attr(data-label); display:flex; align-items:center; justify-content:center;
 position:absolute; width:60px; height:60px; margin:15px; background:var(--card); border-radius:50%; font-weight:bold;}
/* ì£¼ê°„ê³„íš */
.week {display:grid; grid-template-columns:repeat(7,1fr); gap:6px;}
.day {background:var(--card); border:1px solid var(--line); border-radius:8px; padding:6px; display:flex; flex-direction:column;}
.day textarea {flex:1; resize:vertical; min-height:60px;}
/* ë‹¬ë ¥ */
.calendar {display:grid; grid-template-columns:repeat(7,1fr); gap:4px;}
.calendar div {border:1px solid var(--line); border-radius:6px; padding:6px; min-height:60px;}
.calendar .today {background:#d1fae5;}
.toggle {float:right;}
</style>
</head>
<body>
<div class="wrap">

  <div class="card">
    <h1>âœ¨ ë‚˜ë§Œì˜ ê³„íší‘œ (ALL-IN-ONE)</h1>
    <button id="darkToggle" class="btn-outline toggle">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
  </div>

  <!-- ê°„ë‹¨ To-Do -->
  <div class="card">
    <h2>ğŸ“ ê°„ë‹¨ ëª©í‘œ</h2>
    <div class="input-row">
      <input id="simpleTaskInput" placeholder="ë¹ ë¥¸ ë©”ëª¨ ì¶”ê°€" />
      <button id="simpleAddBtn" class="btn">ì¶”ê°€</button>
    </div>
    <ul id="simpleTaskList"></ul>
  </div>

  <!-- ì˜¤ëŠ˜ì˜ ëª©í‘œ + ì™„ë£Œìœ¨ -->
  <div class="card">
    <h2>ğŸ“… ì˜¤ëŠ˜ì˜ ëª©í‘œ</h2>
    <div class="input-row">
      <input type="date" id="datePick"/>
      <button id="todayBtn" class="btn-outline">ì˜¤ëŠ˜</button>
    </div>
    <div class="input-row" style="margin-top:8px">
      <input id="taskInput" placeholder="ì˜ˆ) ìš´ë™ 30ë¶„" />
      <select id="repeatSel">
        <option value="">ë°˜ë³µ ì—†ìŒ</option>
        <option value="daily">ë§¤ì¼</option>
        <option value="weekly">ë§¤ì£¼</option>
        <option value="monthly">ë§¤ì›”</option>
      </select>
      <button id="addBtn" class="btn">ì¶”ê°€</button>
    </div>
    <ul id="taskList"></ul>
    <button id="clearDone" class="btn-outline">ì™„ë£Œ ëª¨ë‘ ì§€ìš°ê¸°</button>
    <button id="exportBtn" class="btn-outline">ë‚´ë³´ë‚´ê¸°</button>
    <input type="file" id="importFile" />
    <div style="margin-top:12px;display:flex;align-items:center;gap:20px;">
      <div style="position:relative;">
        <div id="ring" class="ring" data-label="0%"></div>
      </div>
      <div id="summary">í•  ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.</div>
    </div>
  </div>

  <!-- ì£¼ê°„ê³„íš -->
  <div class="card">
    <h2>ğŸ—“ ì£¼ê°„ ê³„íš</h2>
    <div id="weekGrid" class="week"></div>
  </div>

  <!-- ë‹¬ë ¥ ë·° -->
  <div class="card">
    <h2>ğŸ“† ì›”ê°„ ë‹¬ë ¥</h2>
    <div id="calendar" class="calendar"></div>
  </div>

</div>

<script>
/* ===== Util ===== */
const $=s=>document.querySelector(s);
const fmt=d=>d.toISOString().slice(0,10);
const KEY=ymd=>"plan."+ymd;
function load(date){return JSON.parse(localStorage.getItem(KEY(fmt(date)))||"[]")}
function save(date,arr){localStorage.setItem(KEY(fmt(date)),JSON.stringify(arr))}

/* ===== ê°„ë‹¨ To-Do ===== */
const sInput=$("#simpleTaskInput"), sBtn=$("#simpleAddBtn"), sList=$("#simpleTaskList");
sBtn.onclick=()=>{ if(sInput.value.trim()){const li=document.createElement("li"); li.textContent=sInput.value;
 li.onclick=()=>li.classList.toggle("completed"); sList.appendChild(li); sInput.value=""; } }

/* ===== ì˜¤ëŠ˜ì˜ ëª©í‘œ ===== */
const taskInput=$("#taskInput"), addBtn=$("#addBtn"), taskList=$("#taskList");
const datePick=$("#datePick"), todayBtn=$("#todayBtn"), clearBtn=$("#clearDone");
const exportBtn=$("#exportBtn"), importFile=$("#importFile"), ring=$("#ring"), summary=$("#summary");
const repeatSel=$("#repeatSel");

function render(date){
  const arr=load(date); taskList.innerHTML="";
  arr.sort((a,b)=> (b.star?1:0)-(a.star?1:0)); // ì¤‘ìš”ë„ ìš°ì„ 
  arr.forEach((t,i)=>{
    const li=document.createElement("li"); li.className="task"+(t.done?" completed":"");
    li.innerHTML=`<span class="text">${t.text}</span>
    <span class="meta">${t.repeat? "ğŸ”"+t.repeat:""} ${t.tags?t.tags.join(" "):""}</span>
    <span>
      <span class="star ${t.star?"active":""}">â˜…</span>
      <button class="btn-outline">X</button>
    </span>`;
    li.querySelector(".text").onclick=()=>{arr[i].done=!arr[i].done; save(date,arr); render(date);}
    li.querySelector("button").onclick=()=>{arr.splice(i,1); save(date,arr); render(date);}
    li.querySelector(".star").onclick=()=>{arr[i].star=!arr[i].star; save(date,arr); render(date);}
    taskList.appendChild(li);
  });
  updateStats(date);
}
function addTask(date,text,repeat){
  const tags=text.match(/#\S+/g)||[];
  const arr=load(date); arr.push({text,done:false,repeat,tags,star:false});
  save(date,arr); render(date);
}
function updateStats(date){
  const arr=load(date), done=arr.filter(t=>t.done).length, total=arr.length;
  const pct=total?Math.round(done/total*100):0;
  ring.style.setProperty("--p",pct); ring.setAttribute("data-label",pct+"%");
  summary.textContent=total?`ì´ ${total}ê°œ ì¤‘ ${done}ê°œ ì™„ë£Œ`:"í•  ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.";
}

/* ë°˜ë³µ ì¼ì • ì ìš© */
function applyRepeats(){
  const today=new Date();
  for(let i=0;i<30;i++){ // ì• 30ì¼
    const d=new Date(); d.setDate(today.getDate()+i);
    const arr=load(today).filter(t=>t.repeat);
    arr.forEach(t=>{
      let add=false;
      if(t.repeat==="daily") add=true;
      if(t.repeat==="weekly" && d.getDay()===today.getDay()) add=true;
      if(t.repeat==="monthly" && d.getDate()===today.getDate()) add=true;
      if(add){
        const arr2=load(d);
        if(!arr2.some(x=>x.text===t.text)) {arr2.push({...t,done:false}); save(d,arr2);}
      }
    });
  }
}

/* ì•Œë¦¼ */
function notify(msg){ if(Notification.permission==="granted"){new Notification(msg);} }

/* ì£¼ê°„ ê³„íš */
function mondayOf(date){const d=new Date(date); const day=(d.getDay()+6)%7; d.setDate(d.getDate()-day); return d;}
function loadWeek(mon){return JSON.parse(localStorage.getItem("week."+fmt(mon))||"{}");}
function saveWeek(mon,data){localStorage.setItem("week."+fmt(mon),JSON.stringify(data));}
function renderWeek(date){
  const mon=mondayOf(date); const data=loadWeek(mon); const days=["ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† ","ì¼"];
  weekGrid.innerHTML="";
  days.forEach((d,i)=>{
    const box=document.createElement("div"); box.className="day";
    const val=data[i]||""; box.innerHTML=`<strong>${d}</strong><textarea>${val}</textarea>`;
    box.querySelector("textarea").oninput=e=>{const cur=loadWeek(mon); cur[i]=e.target.value; saveWeek(mon,cur);}
    weekGrid.appendChild(box);
  });
}

/* ë‹¬ë ¥ */
function renderCalendar(date){
  const cal=$("#calendar"); cal.innerHTML="";
  const y=date.getFullYear(), m=date.getMonth(); const first=new Date(y,m,1), last=new Date(y,m+1,0);
  let day=1-first.getDay(); for(let i=0;i<42;i++){
    const d=new Date(y,m,day+i); const div=document.createElement("div");
    div.textContent=d.getDate();
    if(fmt(d)===fmt(new Date())) div.classList.add("today");
    div.onclick=()=>{datePick.value=fmt(d); render(d); renderWeek(d);}
    cal.appendChild(div);
  }
}

/* ì´ë²¤íŠ¸ */
addBtn.onclick=()=>{if(taskInput.value.trim()){addTask(new Date(datePick.value),taskInput.value,repeatSel.value); taskInput.value="";}}
todayBtn.onclick=()=>{const t=new Date(); datePick.value=fmt(t); render(t); renderWeek(t);}
datePick.onchange=()=>{const d=new Date(datePick.value); render(d); renderWeek(d);}
clearBtn.onclick=()=>{const d=new Date(datePick.value); save(d,load(d).filter(t=>!t.done)); render(d);}
exportBtn.onclick=()=>{const d=new Date(datePick.value); const arr=load(d);
 const blob=new Blob([JSON.stringify(arr)],{type:"application/json"}); const a=document.createElement("a");
 a.href=URL.createObjectURL(blob); a.download=`plan_${fmt(d)}.json`; a.click();}
importFile.onchange=e=>{const f=e.target.files[0]; if(f){const r=new FileReader(); r.onload=()=>{save(new Date(datePick.value),JSON.parse(r.result)); render(new Date(datePick.value));}; r.readAsText(f);}}

/* ë‹¤í¬ëª¨ë“œ */
$("#darkToggle").onclick=()=>document.body.classList.toggle("dark");

/* ì´ˆê¸° */
(function init(){
  if(Notification.permission!=="granted") Notification.requestPermission();
  const t=new Date(); datePick.value=fmt(t);
  render(t); renderWeek(t); renderCalendar(t);
  applyRepeats();
})();
</script>
</body>
</html>
