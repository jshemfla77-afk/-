<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>âœ¨ ë‚˜ì˜ ì˜¤ëŠ˜ì˜ ëª©í‘œ âœ¨</title>
<style>
  body { font-family: 'Pretendard', sans-serif; background: #f6f9ff; text-align: center; margin: 0; padding: 0; }
  h1 { margin-top: 40px; color: #222; }
  input, textarea { border: 1px solid #ccc; border-radius: 8px; padding: 10px; width: 300px; margin: 8px; font-size: 15px; }
  button { background: #3b57f6; color: white; border: none; border-radius: 6px; padding: 8px 14px; cursor: pointer; transition: 0.2s; margin: 4px; }
  button:hover { background: #2c45d0; }
  .fade { animation: fade 0.8s ease; }
  @keyframes fade { 0%{opacity:0.2;}100%{opacity:1;} }
</style>
</head>
<body>
  <h1>âœ¨ ë‚˜ì˜ ì˜¤ëŠ˜ì˜ ëª©í‘œ âœ¨</h1>

  <div>
    <input id="goalInput" type="text" placeholder="ìƒˆë¡œìš´ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”!" />
    <button id="addGoalBtn">ì¶”ê°€</button>
  </div>

  <div>
    <h3>ğŸ—“ ì£¼ê°„ ê³„íš</h3>
    <textarea id="weeklyPlan" rows="4" placeholder="ì´ë²ˆ ì£¼ ê³„íšì„ ì ì–´ë³´ì„¸ìš”!"></textarea><br />
    <button id="savePlanBtn">ì €ì¥</button>
  </div>

  <hr style="margin:25px 0;">
  <div>
    <h3>â˜ Google Drive ë°±ì—…/ë³µì›</h3>
    <button id="loginBtn">Google ë¡œê·¸ì¸</button>
    <button id="manualBackupBtn">ìˆ˜ë™ ë°±ì—…</button>
  </div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = 'âœ…ì—¬ê¸°ì—_ë³¸ì¸_OAuth_Client_ID_ì…ë ¥'; 
    const API_KEY = 'âœ…ì—¬ê¸°ì—_ë³¸ì¸_API_KEY_ì…ë ¥';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const FILE_NAME = "my_goals.json";

    function log(t){console.log("ğŸ“˜",t);}
    function showSaved(btn){btn.innerText="âœ… ì €ì¥ë¨!";setTimeout(()=>btn.innerText="ì €ì¥",1200);}

    function initClient(){
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
        scope: SCOPES
      }).then(()=>{
        log("Google API ì´ˆê¸°í™” ì™„ë£Œ");
        document.getElementById("loginBtn").disabled=false;
      });
    }

    function handleClientLoad(){ gapi.load('client:auth2', initClient); }

    async function signIn(){
      try{
        await gapi.auth2.getAuthInstance().signIn();
        alert("âœ… ë¡œê·¸ì¸ ì„±ê³µ!");
        await restoreFromDrive();
      }catch(e){alert("ë¡œê·¸ì¸ ì‹¤íŒ¨:"+e.message);}
    }

    async function autoBackup(){
      const data={
        goal:document.getElementById('goalInput').value,
        plan:document.getElementById('weeklyPlan').value
      };
      const blob=new Blob([JSON.stringify(data)],{type:'application/json'});
      const files=await gapi.client.drive.files.list({q:`name='${FILE_NAME}'`,fields:'files(id)'});
      if(files.result.files.length>0){
        const fileId=files.result.files[0].id;
        await gapi.client.request({
          path:`/upload/drive/v3/files/${fileId}`,
          method:'PATCH',
          params:{uploadType:'media'},
          body:blob
        });
      }else{
        await gapi.client.drive.files.create({
          resource:{name:FILE_NAME,mimeType:'application/json'},
          media:{mimeType:'application/json',body:blob}
        });
      }
      log("Driveì— ìë™ ë°±ì—… ì™„ë£Œ");
    }

    async function restoreFromDrive(){
      const res=await gapi.client.drive.files.list({q:`name='${FILE_NAME}'`,fields:'files(id)'});
      if(res.result.files.length>0){
        const fileId=res.result.files[0].id;
        const file=await gapi.client.drive.files.get({fileId,alt:'media'});
        const data=JSON.parse(file.body);
        document.getElementById('goalInput').value=data.goal||'';
        document.getElementById('weeklyPlan').value=data.plan||'';
        alert("Driveì—ì„œ ë³µì› ì™„ë£Œ!");
      }else log("Driveì— ì €ì¥ëœ íŒŒì¼ ì—†ìŒ");
    }

    document.getElementById('loginBtn').onclick=signIn;
    document.getElementById('savePlanBtn').onclick=async(e)=>{
      showSaved(e.target);
      await autoBackup();
    };
    document.getElementById('manualBackupBtn').onclick=autoBackup;

    window.onload=handleClientLoad;
  </script>
</body>
</html>

